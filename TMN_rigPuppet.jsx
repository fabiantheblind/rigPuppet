//TMN_rigPuppet.jsxrigPuppet();function rigPuppet(){app.beginUndoGroup("Rig Puppet");	    var curComp = app.project.activeItem;    if (!curComp || !(curComp instanceof CompItem))    {        alert("Please select a Composition.");        return;    }	var thePuppet = curComp.selectedLayers[0];	var thePuppetsName = thePuppet.source.name;      try{      var effect = thePuppet.Effects.addProperty("tmnpuppet");	effect.name = thePuppetsName +"_RIG";      //newNull.Effects.addProperty("TMNpuppet");      }catch (e){            $.writeln(e);			return;          }	// the coustum effect is applyed. now we need to rig the effects	// so we have to get the controllers within the comp	// first layer is head control second bodycontrol	//alert(thePuppet.source.layer(1).source.name );	//alert(thePuppet.source.layer(1).effect(1).name );	// the head timeremap uplink	var eyesExpr = "comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"eyes\")";	var mouthExpr = "comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"mouth\")";	var headsExpr = "comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"head\")";		thePuppet.source.layer(1).effect("mouth").property("ADBE Slider Control-0001").expression = mouthExpr;	thePuppet.source.layer(1).effect("eyes").property("ADBE Slider Control-0001").expression =eyesExpr;	thePuppet.source.layer(2).effect("heads").property("ADBE Slider Control-0001").expression = headsExpr;		// the head position and rotation uplink	var headPosExpr = "value + comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"headposition\")";	var headRotExpr = "value + comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"headrotate\")";	thePuppet.source.layer("heads").position.expression = headPosExpr;	thePuppet.source.layer("heads").rotation.expression = headRotExpr;		//the body timeremap uplink	var armFrontExpr = "comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"front\")";	var armBehindExpr = "comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"behind\")";	var bodyExpr = "comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"body\")";	var legleftExpr = "comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"left\")";	var legRightExpr = "comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"right\")";		thePuppet.source.layer(2).effect("arm_front").property("ADBE Slider Control-0001").expression =armFrontExpr;	thePuppet.source.layer(2).effect("body").property("ADBE Slider Control-0001").expression =bodyExpr;	thePuppet.source.layer(2).effect("arm_behind").property("ADBE Slider Control-0001").expression =armBehindExpr;	thePuppet.source.layer(2).effect("leg_left").property("ADBE Slider Control-0001").expression =legleftExpr;	thePuppet.source.layer(2).effect("leg_right").property("ADBE Slider Control-0001").expression =legRightExpr;			// the body and legs and arms position and rotation uplink		// the body	var bodyPosExpr = "value + comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"bodyposition\")";	var bodyRotExpr = "value + comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"bodyrotate\")";	thePuppet.source.layer("body").position.expression = bodyPosExpr;	thePuppet.source.layer("body").rotation.expression = bodyRotExpr;	// leg left	var leftPosExpr = "value + comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"position left\")";	var leftRotExpr = "value + comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"rotate left\")";	thePuppet.source.layer("leg_left").position.expression = leftPosExpr;	thePuppet.source.layer("leg_left").rotation.expression = leftRotExpr;	// leg right	var rightPosExpr = "value + comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"position right\")";	var rightRotExpr = "value + comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"rotate right\")";	thePuppet.source.layer("leg_right").position.expression = rightPosExpr;	thePuppet.source.layer("leg_right").rotation.expression = rightRotExpr;			// arm front	var frontPosExpr = "value + comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"position front\")";	var frontRotExpr = "value + comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"rotate front\")";	thePuppet.source.layer("arm_front").position.expression = frontPosExpr;	thePuppet.source.layer("arm_front").rotation.expression = frontRotExpr;	// arm behind	var behindPosExpr = "value + comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"position behind\")";	var behindRotExpr = "value + comp(\""+ curComp.name +"\").layer(\""+thePuppetsName+"\").effect(\""+thePuppetsName+"_RIG\")(\"rotate behind\")";	thePuppet.source.layer("arm_behind").position.expression = behindPosExpr;	thePuppet.source.layer("arm_behind").rotation.expression = behindRotExpr;			// apply the mirrir expression	var theScaleValue = thePuppet.scale.valueAtTime(0,true);	effect("slider").setValue(theScaleValue[0]);		var scaleExpr = "var posNeg;\n"+	"if(effect(\""+thePuppetsName+"_RIG\")(\"mirrorpuppet\")==true)\n"+	"{posNeg = 1;\n"+	"}else{\n"+	"posNeg = -1;\n"+	"}\n"+	"var w = effect(\""+thePuppetsName+"_RIG\")(\"slider\")* posNeg;\n"+	"var h = effect(\""+thePuppetsName+"_RIG\")(\"slider\");\n"+	"[w,h]";	thePuppet.scale.expression = scaleExpr;	app.endUndoGroup();	}